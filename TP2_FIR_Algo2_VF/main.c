#include "dsk6713_aic23.h"

Uint32 input_left_sample();
void output_left_sample(int out_data);
void comm_intr();

Uint32 fs = DSK6713_AIC23_FREQ_8KHZ;

#define    N     128      // Nombre de coefficients du filtre

// Frequence d'echantillonnage Fs = 8000

float h[128]= {-0.000001,-0.000003,-0.000006,-0.000004,0.000005,0.000018,0.000025,0.000014,-0.000019,-0.000059,-0.000075,-0.000039,0.000049,0.000147,0.000181,0.000091,
-0.000110,-0.000318,-0.000378,-0.000186,0.000218,0.000617,0.000720,0.000346,-0.000399,-0.001109,-0.001271,-0.000601,0.000684,0.001875,0.002120,0.000991,
-0.001114,-0.003018,-0.003379,-0.001563,0.001743,0.004681,0.005200,0.002389,-0.002647,-0.007071,-0.007818,-0.003578,0.003953,0.010539,0.011643,0.005331,
-0.005900,-0.015788,-0.017539,-0.008095,0.009055,0.024580,0.027822,0.013158,-0.015198,-0.043044,-0.051597,-0.026431,0.034305,0.116770,0.195535,0.243552,
0.243552,0.195535,0.116770,0.034305,-0.026431,-0.051597,-0.043044,-0.015198,0.013158,0.027822,0.024580,0.009055,-0.008095,-0.017539,-0.015788,-0.005900,
0.005331,0.011643,0.010539,0.003953,-0.003578,-0.007818,-0.007071,-0.002647,0.002389,0.005200,0.004681,0.001743,-0.001563,-0.003379,-0.003018,-0.001114,
0.000991,0.002120,0.001875,0.000684,-0.000601,-0.001271,-0.001109,-0.000399,0.000346,0.000720,0.000617,0.000218,-0.000186,-0.000378,-0.000318,-0.000110,
0.000091,0.000181,0.000147,0.000049,-0.000039,-0.000075,-0.000059,-0.000019,0.000014,0.000025,0.000018,0.000005,-0.000004,-0.000006,-0.000003,-6.812830e-07 };

short Xn, i;
float XnBuffer[N+1], YnBuffer[N];
Uint16 j;
float Yn;



interrupt void c_int11()
{
	Xn = input_left_sample();
	XnBuffer[0] = (float) Xn;

	Yn = 0.0;
	for(i = N-1; i >= 0; i--){
		Yn = Yn + h[i] * XnBuffer[i];
		XnBuffer[i+1] = XnBuffer[i];
	}

	YnBuffer[j] = Yn;

	output_left_sample( (short) YnBuffer[j]);

	j = (j + 1) % N;

	return;
}

main()
{
	j = 0;
	for(i = 0; i <= N-1; i++) XnBuffer[i] = 0;
	comm_intr();
	while(1);
}
